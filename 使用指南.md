# 📚 小说内容智能合并系统 - 使用指南

## 🎯 系统概述

本系统提供了两种使用方式来优化小说内容合并的人机交互体验：

1. **交互式菜单系统** (`interactive_merge_menu.py`) - 图形化菜单界面
2. **快速合并脚本** (`quick_merge.py`) - 命令行快速操作

## 🖥️ 交互式菜单系统

### 启动方式
```bash
python interactive_merge_menu.py
```

### 功能特性
- 🎨 友好的控制台界面
- 📋 分步骤引导操作
- 🔧 初始化爬虫配置（域名文件、输出目录、Selenium选项、基准源等）
- 🔍 搜索并爬取小说（支持章节数和并发数配置）
- 📚 查看已爬取小说（浏览已爬取的小说列表，查看详细信息）
- ⚙️ 多种预设合并策略
- 🔧 自定义策略配置
- 💾 配置模板保存/加载
- 📊 实时配置查看
- ⚙️ 高级配置（修改基准源、Selenium模式、输出目录、域名文件等）
- ❓ 详细帮助说明

### 使用流程

#### 1. 初始化爬虫配置
- 设置域名配置文件 (默认: `all_domains.json`)
- 设置输出目录 (默认: `novel_output`)
- 配置基准源 (推荐: `biquge7,bqgam,675m`)

#### 2. 设置小说标题
- 输入要合并的小说名称
- 系统会显示可用的小说列表

#### 3. 选择合并策略

| 策略 | 描述 | 适用场景 |
|------|------|----------|
| 🎯 默认策略 | 平衡的合并策略 | 大多数情况，推荐首选 |
| 📏 长度优先 | 优先选择内容最长的版本 | 需要最完整内容 |
| 💎 质量优先 | 优先选择质量最高的版本 | 注重内容质量 |
| 🔄 差分合并 | 智能合并多个版本的内容 | 尝试新功能 |
| 🛡️ 保守策略 | 严格筛选，确保内容质量 | 对质量要求极高 |
| 🚀 激进策略 | 最大化内容获取 | 需要尽可能多的内容 |
| 🔧 自定义策略 | 手动配置所有参数 | 专业用户定制 |

#### 4. 执行合并
- 一键启动智能合并过程
- 实时显示合并进度
- 自动保存合并结果

### 高级功能

#### 搜索并爬取功能
- **直接搜索**: 在菜单中直接搜索小说
- **章节限制**: 配置最大章节数限制
- **并发设置**: 设置并发爬取数量
- **自动设置**: 自动设置小说标题

#### 已爬取小说管理
- **小说列表**: 查看所有已爬取的小说
- **状态显示**: 显示域名数量和合并状态
- **详细信息**: 查看小说详细信息
- **快速选择**: 快速选择小说进行合并

#### 高级配置管理
- **基准源配置**: 修改基准源配置
- **Selenium模式**: 切换Selenium模式
- **输出目录**: 更改输出目录
- **域名文件**: 重新加载域名文件
- **缓存清理**: 清理缓存数据
- **域名状态**: 查看域名状态

#### 配置模板管理
- **保存模板**: 将当前配置保存为模板，方便重复使用
- **加载模板**: 快速应用之前保存的配置

#### 自定义策略配置

| 参数 | 说明 | 范围 | 默认值 |
|------|------|------|--------|
| 差分合并 | 是否启用智能合并算法 | y/n | y |
| 长度权重 | 内容长度在选择中的重要性 | 0-1 | 0.6 |
| 质量权重 | 内容质量在选择中的重要性 | 0-1 | 0.4 |
| 最小长度 | 有效内容的最小字符数 | >0 | 200 |
| 合并阈值 | 触发合并的内容增长比例 | >1.0 | 1.1 |
| 相似度阈值 | 内容相似度判断标准 | 0-1 | 0.8 |

## ⚡ 快速合并脚本

### 启动方式
```bash
# 使用默认策略
python quick_merge.py "小说标题"

# 指定策略
python quick_merge.py "小说标题" 策略名称
```

### 可用策略

| 策略名称 | 说明 |
|----------|------|
| `default` | 默认策略 (推荐) |
| `length` | 长度优先策略 |
| `quality` | 质量优先策略 |
| `diff` | 差分合并策略 |
| `conservative` | 保守策略 |
| `aggressive` | 激进策略 |

### 使用示例

```bash
# 基本使用
python quick_merge.py "凡人修仙传"

# 使用质量优先策略
python quick_merge.py "凡人修仙传" quality

# 使用差分合并策略
python quick_merge.py "斗破苍穹" diff

# 使用保守策略
python quick_merge.py "完美世界" conservative
```

## 📊 输出结果

合并完成后，结果将保存在以下位置：

```
novel_output/
└── 小说标题/
    └── merged_best/
        ├── 小说标题_merged.txt      # 合并后的完整文本
        ├── 小说标题_merged_info.json # 合并信息和统计
        └── 小说标题_comparison.json  # 内容比对报告
```

### 文件说明

- **merged.txt**: 最终合并的小说文本文件
- **merged_info.json**: 包含合并统计信息、章节来源等
- **comparison.json**: 详细的内容比对和选择报告

## 🔧 配置参数详解

### 差分合并 (enable_diff_merge)
- **作用**: 启用智能差分合并算法
- **建议**: 一般情况下建议启用，可以获得更完整的内容

### 长度权重 (length_priority_weight)
- **作用**: 控制内容长度在选择中的重要性
- **调整**: 值越大越偏向选择长内容，值越小越不看重长度

### 质量权重 (quality_weight)
- **作用**: 控制内容质量在选择中的重要性
- **调整**: 值越大越偏向选择高质量内容

### 最小内容长度 (min_content_length)
- **作用**: 过滤掉过短的无效内容
- **调整**: 根据小说类型调整，一般小说章节建议200-500字符

### 合并阈值 (merge_threshold)
- **作用**: 控制何时触发差分合并
- **调整**: 值越小越容易触发合并，值越大越保守

### 相似度阈值 (similarity_threshold)
- **作用**: 判断内容是否相似的标准
- **调整**: 值越高要求越严格，值越低越宽松

## 💡 使用建议

### 新手用户
1. 使用交互式菜单系统
2. 选择"默认策略"
3. 按步骤完成配置和合并

### 熟练用户
1. 使用快速合并脚本提高效率
2. 根据小说特点选择合适策略
3. 保存常用配置为模板

### 专业用户
1. 使用自定义策略精确控制
2. 根据内容特点调整参数
3. 分析比对报告优化策略

## 🚀 性能优化建议

1. **基准源配置**: 选择稳定、质量高的域名作为基准源
2. **策略选择**: 根据网络状况和内容需求选择合适策略
3. **参数调优**: 根据实际效果调整权重和阈值参数
4. **批量处理**: 使用快速脚本进行批量合并操作

## ❓ 常见问题

### Q: 合并失败怎么办？
A: 检查网络连接、域名文件是否存在、小说标题是否正确

### Q: 如何选择最佳策略？
A: 建议先用默认策略，根据效果再调整为其他策略

### Q: 配置参数如何调优？
A: 可以通过比对报告分析效果，逐步调整参数

### Q: 如何处理特殊字符？
A: 系统内置了广告清理和特殊字符处理功能

## 📞 技术支持

如遇到问题，请检查：
1. Python环境和依赖包是否正确安装
2. 域名配置文件是否存在且格式正确
3. 网络连接是否正常
4. 小说数据是否已爬取

---

**祝您使用愉快！** 📚✨